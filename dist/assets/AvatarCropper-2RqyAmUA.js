import{r as d,j as t}from"./vendor-BEfqtVUe.js";import{D as f,a as v,b as w,d as D,e as y,B as j}from"./index-Cq3WAw90.js";import{L as S,B as I,S as L}from"./image-crop-BdQ6hKWd.js";import"./utils-DxjPgW5d.js";import"./ui-vendor-DQ8_5H5A.js";import"./state-DlvjQ27R.js";import"./lucide-react-NQr80gjg.js";import"./router-24HdL0-o.js";function N(a){return a.toDataURL("image/jpeg",.9)}async function R(a,e){const r=document.createElement("canvas"),c=r.getContext("2d"),n=a.naturalWidth/a.width,o=a.naturalHeight/a.height;return r.width=e.width*n,r.height=e.height*o,c.drawImage(a,e.x*n,e.y*o,e.width*n,e.height*o,0,0,e.width*n,e.height*o),N(r)}const b=(a,e)=>{const[r,c]=d.useState(),[n,o]=d.useState(),i=d.useRef(null),h=d.useCallback(s=>{const{width:l,height:u}=s.currentTarget,x=S(I({unit:"%",width:80},3/4,l,u),l,u);c(x),o(x)},[]);return{crop:r,completedCrop:n,imgRef:i,onImageLoad:h,onCropChange:(s,l)=>{c(l)},onCropComplete:s=>{o(s)},handleSave:async()=>{if(n&&i.current)try{const s=await R(i.current,n);a(s),e()}catch(s){console.error("Failed to crop image:",s)}},handleCancel:()=>{e()}}},O=({isOpen:a,onClose:e,imageSrc:r,onCropComplete:c})=>{const{crop:n,completedCrop:o,imgRef:i,onImageLoad:h,onCropChange:p,onCropComplete:m,handleSave:C,handleCancel:g}=b(c,e);return t.jsx(f,{open:a,onOpenChange:e,children:t.jsxs(v,{className:"max-w-2xl",children:[t.jsxs(w,{children:[t.jsx(D,{children:"裁剪头像"}),t.jsx(y,{children:"拖拽调整裁剪区域，点击保存完成头像设置。"})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"flex justify-center",children:t.jsx(L,{crop:n,onChange:p,onComplete:m,aspect:3/4,children:t.jsx("img",{ref:i,src:r,alt:"裁剪头像",onLoad:h,className:"max-h-96"})})}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(j,{variant:"outline",onClick:g,children:"取消"}),t.jsx(j,{onClick:C,disabled:!o,children:"保存"})]})]})]})})};export{O as AvatarCropper,O as default};
