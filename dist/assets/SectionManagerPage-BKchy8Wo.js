import{r as E,j as e}from"./vendor-BEfqtVUe.js";import{f as J,L as I,I as X,g as Y,B as x,r as H,R as K,A as Q}from"./index-Cq3WAw90.js";import{u as W,a as ee,v as se,b as te,P as ae,c as ne,C as ie,D as le,S as re}from"./dnd-kit-DQgtQVn-.js";import{S as ce}from"./select-BwaCunmu.js";import{J as oe,al as de,am as me,an as A,ad as xe,X as he,ao as ge,a3 as ue,O as pe,P as O,ap as je,aq as fe,a7 as ve,a9 as be,ar as Ne}from"./lucide-react-NQr80gjg.js";import{u as ye}from"./state-DlvjQ27R.js";import{u as we}from"./router-24HdL0-o.js";import"./utils-DxjPgW5d.js";import"./ui-vendor-DQ8_5H5A.js";const Se=()=>{const[i,l]=E.useState(null),[o,d]=E.useState(""),[f,p]=E.useState(null),v=W(ee(ae,{activationConstraint:{distance:8}})),{getNonBasicSections:b,updateSectionsOrder:h,updateSection:N,updateSectionTitle:g,updateSectionIcon:S,updateSectionEditorType:j,toggleSectionVisibility:m,deleteSection:y,addSection:k,getSection:D}=J(),c=b,C=s=>s.editorType||"timeline",$=(s,t,a)=>{if(t===a)return s;if(t==="timeline"&&a==="list")return s.map(n=>({id:n.id,content:`${n.title}${n.subtitle?` - ${n.subtitle}`:""}${n.description?`: ${n.description}`:""}`}));if(t==="list"&&a==="timeline")return s.map(n=>({id:n.id,title:n.content.slice(0,50)+(n.content.length>50?"...":""),subtitle:"",secondarySubtitle:"",startDate:"",endDate:"",description:n.content}));if(a==="text"){if(t==="timeline")return{content:s.map(n=>`${n.title}
${n.subtitle}
${n.description}`).join(`

`)};if(t==="list")return{content:s.map(n=>n.content).join(`
`)}}if(t==="text"){const n=s.content||"";if(a==="timeline")return[{id:Date.now().toString(),title:"标题",subtitle:"",secondarySubtitle:"",startDate:"",endDate:"",description:n}];if(a==="list")return n.split(`
`).map((w,G)=>({id:(Date.now()+G).toString(),content:w}))}return s},T=(s,t)=>{const a=D(s);if(!a)return;const r=C(a),n=$(a.data,r,t);j(s,t),N(s,n)},u=s=>{const t=s.map((a,r)=>({...a,order:r+2}));h(t)},P=s=>{const t=c.findIndex(r=>r.id===s);if(t<=0)return;const a=[...c];[a[t-1],a[t]]=[a[t],a[t-1]],u(a)},F=s=>{const t=c.findIndex(r=>r.id===s);if(t>=c.length-1)return;const a=[...c];[a[t],a[t+1]]=[a[t+1],a[t]],u(a)},z=s=>{const{active:t,over:a}=s;if(!a||t.id===a.id)return;const r=c.findIndex(w=>w.id===t.id),n=c.findIndex(w=>w.id===a.id);if(r!==-1&&n!==-1){const w=te(c,r,n);u(w)}},L=s=>{m(s)},V=s=>{y(s)},R=s=>{l(s.id),d(s.title)},Z=()=>{i&&o.trim()&&(g(i,o.trim()),l(null),d(""))},B=()=>{l(null),d("")},_=(s,t)=>{S(s,t)},q=()=>{const s={id:`custom-${Date.now()}`,title:"新模块",iconName:"star",type:"timeline",editorType:"timeline",visible:!0,order:c.length+2,data:[]};k(s),R(s)},U={sensors:v,onDragEnd:z,sortableItems:c.map(s=>s.id),strategy:se};return{managedSections:c,editingId:i,editingTitle:o,showIconSelector:f,setEditingTitle:d,setShowIconSelector:p,deleteSection:V,addCustomSection:q,startEditing:R,saveEditing:Z,cancelEditing:B,updateSectionIcon:_,getEditorType:C,updateEditorType:T,toggleVisibility:L,moveUp:P,moveDown:F,dragConfig:U,handleDragEnd:z}},M=[{value:"timeline",label:"时间线编辑器",description:"适合工作经历、教育背景等时序信息",icon:oe},{value:"list",label:"列表编辑器",description:"适合技能清单、证书列表等",icon:de},{value:"text",label:"文本编辑器",description:"适合自我介绍、备注等自由文本",icon:me}],Ce=({section:i,isEditing:l,editingTitle:o,onStartEditing:d,onSaveEditing:f,onCancelEditing:p,onTitleChange:v,onIconChange:b,onEditorTypeChange:h,onDelete:N,getEditorType:g})=>{const{attributes:S,listeners:j,setNodeRef:m,transform:y,transition:k,isDragging:D}=ne({id:i.id,disabled:l}),c={transform:ie.Transform.toString(y),transition:k,opacity:D?.5:1},C=g(i),$=M.find(u=>u.value===C),T=u=>{h(u)};return e.jsx("div",{ref:m,style:c,className:`group border border-gray-200 rounded-lg bg-white shadow-sm hover:shadow-md transition-all duration-200 ${D?"shadow-lg scale-105":""}`,children:e.jsxs("div",{className:"flex items-center gap-3 p-4",children:[e.jsx("div",{...S,...j,className:`flex-shrink-0 p-1 rounded hover:bg-gray-100 transition-colors cursor-grab active:cursor-grabbing ${l?"cursor-not-allowed opacity-50":""}`,children:e.jsx(A,{className:"h-4 w-4 text-gray-400"})}),e.jsx("div",{className:"flex-1 min-w-0",children:l?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(I,{htmlFor:`title-${i.id}`,className:"text-xs text-gray-500",children:"模块标题"}),e.jsx(X,{id:`title-${i.id}`,value:o,onChange:u=>v(u.target.value),placeholder:"请输入模块标题",className:"h-8 text-sm"})]}),e.jsx("div",{className:"space-y-1",children:e.jsx(Y,{value:i.iconName,onChange:b,label:"图标"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(I,{htmlFor:`editor-${i.id}`,className:"text-xs text-gray-500",children:"编辑器类型"}),e.jsx(ce,{value:C,onValueChange:T,placeholder:"选择编辑器类型",options:M})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-1",children:[e.jsxs(x,{onClick:f,size:"sm",className:"h-7 px-2 text-xs bg-blue-600 hover:bg-blue-700",children:[e.jsx(xe,{className:"h-3 w-3 mr-1"}),"保存"]}),e.jsxs(x,{onClick:p,variant:"outline",size:"sm",className:"h-7 px-2 text-xs",children:[e.jsx(he,{className:"h-3 w-3 mr-1"}),"取消"]})]})]}):e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 text-sm truncate",children:i.title}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[$?.label," • ",i.visible?"显示中":"已隐藏"]})]})}),!l&&e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(x,{onClick:d,variant:"ghost",size:"icon",className:"h-7 w-7 hover:bg-gray-100",children:e.jsx(ge,{className:"h-3 w-3 text-gray-600"})}),e.jsx(x,{onClick:N,variant:"ghost",size:"icon",className:"h-7 w-7 hover:bg-red-50 hover:text-red-600",children:e.jsx(ue,{className:"h-3 w-3"})})]})]})})},De=()=>{const{managedSections:i,editingId:l,editingTitle:o,setEditingTitle:d,deleteSection:f,addCustomSection:p,startEditing:v,saveEditing:b,cancelEditing:h,updateSectionIcon:N,getEditorType:g,updateEditorType:S,dragConfig:j}=Se();return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"px-4 md:px-6 lg:px-8 py-3 md:py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h2",{className:"font-semibold text-gray-900 text-base md:text-lg",children:"模块列表"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1 hidden md:block",children:"拖拽调整顺序，编辑模块属性"})]}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1 flex-shrink-0 hidden md:flex",children:[e.jsx(A,{className:"h-3 w-3"}),"拖拽排序"]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 md:px-6 lg:px-8",children:e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"space-y-3 md:space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(I,{className:"font-medium text-gray-700 text-sm",children:["当前模块 (",i.length,")"]})}),e.jsx(le,{sensors:j.sensors,onDragEnd:j.onDragEnd,children:e.jsx(re,{items:j.sortableItems,strategy:j.strategy,children:e.jsx("div",{className:"space-y-2 md:space-y-3",children:i.map(m=>e.jsx(Ce,{section:m,isEditing:l===m.id,editingTitle:o,onStartEditing:()=>v(m),onSaveEditing:b,onCancelEditing:h,onTitleChange:d,onIconChange:y=>N(m.id,y),onEditorTypeChange:y=>S(m.id,y),onDelete:()=>f(m.id),getEditorType:g},m.id))})})}),i.length===0&&e.jsxs("div",{className:"text-center py-8 md:py-12 text-gray-500",children:[e.jsx(pe,{className:"mx-auto mb-4 text-gray-300 h-12 w-12 md:h-16 md:w-16"}),e.jsx("h3",{className:"font-medium text-gray-900 mb-2 text-base md:text-lg",children:"还没有自定义模块"}),e.jsx("p",{className:"text-gray-600 mb-4 text-xs md:text-sm",children:"添加第一个模块开始定制您的简历"}),e.jsxs(x,{onClick:p,size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(O,{className:"h-4 w-4 mr-1"}),"添加模块"]})]})]}),i.length>0&&e.jsxs("div",{className:"border-t py-4 md:pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(I,{className:"font-medium text-gray-700 text-sm",children:"添加新模块"}),e.jsxs(x,{onClick:p,size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(O,{className:"h-4 w-4 mr-1"}),"添加模块"]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2 hidden md:block",children:"新添加的模块将显示在模块列表的最后，你可以通过拖拽调整位置。"})]})]})})]})},Ee=()=>{const i=ye(H),l=()=>100,[o,d]=E.useState(l()),f=()=>{d(g=>Math.min(g+10,150))},p=()=>{d(g=>Math.max(g-10,50))},v=()=>{d(l())},b=()=>{const h=`${window.location.origin}${window.location.pathname}#/preview`;window.open(h,"_blank","noopener,noreferrer")};return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"px-4 md:px-6 py-3 md:py-4 border-b border-gray-200 bg-white flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h2",{className:"font-semibold text-gray-900 text-base md:text-lg",children:"实时预览"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1 hidden md:block",children:"左侧的修改会立即在此处显示"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-1 px-2 md:px-3 py-1 bg-gray-100 rounded-lg",children:[e.jsx(x,{onClick:p,variant:"ghost",size:"icon",className:"h-6 w-6 md:h-6 md:w-6",disabled:o<=50,children:e.jsx(je,{className:"h-3 w-3"})}),e.jsxs("span",{className:"font-medium text-gray-600 text-center text-xs min-w-[2.5rem] md:min-w-[3rem]",children:[o,"%"]}),e.jsx(x,{onClick:f,variant:"ghost",size:"icon",className:"h-6 w-6 md:h-6 md:w-6",disabled:o>=150,children:e.jsx(fe,{className:"h-3 w-3"})}),e.jsx(x,{onClick:v,variant:"ghost",size:"icon",className:"h-6 w-6 md:h-6 md:w-6 ml-1",title:"重置缩放",children:e.jsx(ve,{className:"h-3 w-3"})})]}),e.jsxs(x,{onClick:b,variant:"outline",size:"sm",className:"flex items-center space-x-2",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"预览 & 导出"})]})]})]})}),e.jsx("div",{className:"flex-1 overflow-auto bg-gray-50 p-3 md:p-6",children:e.jsx("div",{className:"flex justify-start md:justify-center min-h-full md:min-h-0",children:e.jsx("div",{className:"bg-white w-full md:rounded-lg md:shadow-lg overflow-hidden",children:e.jsx(K,{resume:i,isEditable:!1,scale:o,className:"min-h-0 vertical-layout-preview"})})})})]})},Ie=()=>{const i=we(),l=()=>{i("/")};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-blue-50 to-purple-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(x,{onClick:l,variant:"outline",size:"sm",className:"flex items-center space-x-2",children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"返回"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("div",{children:e.jsx("h1",{className:"text-lg font-semibold text-gray-900 flex items-center gap-3",children:"模块管理"})})})]})})}),e.jsxs("div",{className:"flex flex-col lg:flex-row",children:[e.jsx("div",{className:"w-full lg:w-1/2 border-b lg:border-b-0 lg:border-r border-gray-200 bg-white h-1/2 lg:h-full overflow-hidden",children:e.jsx(De,{})}),e.jsx("div",{className:"w-full lg:w-1/2 bg-gray-50 h-1/2 lg:h-full overflow-hidden",children:e.jsx(Ee,{})})]}),e.jsx(Q,{})]})},Fe=()=>e.jsx(Ie,{});export{Fe as SectionManagerPage};
