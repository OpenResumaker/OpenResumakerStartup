import{r as p,j as e}from"./vendor-BEfqtVUe.js";import{f as K,r as F,g as Q,h as ee,i as te,j as se,L as z,I as ae,k as ne,B as N,R as ie,A as re}from"./index-DsEmokA7.js";import{u as le,a as oe,v as L,b as ce,P as de,c as me,C as xe,d as ge,S as he,D as ue}from"./dnd-kit-XX601_NE.js";import{d as k,u as B}from"./state-DlvjQ27R.js";import{S as pe}from"./select-BZTcJqOQ.js";import{J as je,al as fe,am as ve,an as be,ad as ye,X as Ne,ao as Se,a3 as V,F as M,P as Z,ap as we,aq as Ce,a7 as Ee,a9 as De,ar as Pe}from"./lucide-react-NQr80gjg.js";import{u as Ie}from"./router-24HdL0-o.js";import"./utils-DxjPgW5d.js";import"./ui-vendor-DQ8_5H5A.js";const ke=()=>{const[a,l]=p.useState(null),[c,d]=p.useState(""),[b,x]=p.useState(null),u=le(oe(de,{activationConstraint:{distance:8}})),{getNonBasicSections:y,updateSectionsOrder:g,updateSection:S,updateSectionTitle:j,updateSectionIcon:E,updateSectionEditorType:w,toggleSectionVisibility:f,deleteSection:C,addSection:v,getSection:n}=K(),t=y,m=s=>s.editorType||"timeline",P=(s,i,r)=>{if(i===r)return s;if(i==="timeline"&&r==="list")return s.map(o=>({id:o.id,content:`${o.title}${o.subtitle?` - ${o.subtitle}`:""}${o.description?`: ${o.description}`:""}`}));if(i==="list"&&r==="timeline")return s.map(o=>({id:o.id,title:o.content.slice(0,50)+(o.content.length>50?"...":""),subtitle:"",secondarySubtitle:"",startDate:"",endDate:"",description:o.content}));if(r==="text"){if(i==="timeline")return{content:s.map(o=>`${o.title}
${o.subtitle}
${o.description}`).join(`

`)};if(i==="list")return{content:s.map(o=>o.content).join(`
`)}}if(i==="text"){const o=s.content||"";if(r==="timeline")return[{id:Date.now().toString(),title:"标题",subtitle:"",secondarySubtitle:"",startDate:"",endDate:"",description:o}];if(r==="list")return o.split(`
`).map((I,H)=>({id:(Date.now()+H).toString(),content:I}))}return s},A=(s,i)=>{const r=n(s);if(!r)return;const h=m(r),o=P(r.data,h,i);w(s,i),S(s,o)},D=s=>{const i=s.map((r,h)=>({...r,order:h+2}));g(i)},T=s=>{const i=t.findIndex(h=>h.id===s);if(i<=0)return;const r=[...t];[r[i-1],r[i]]=[r[i],r[i-1]],D(r)},_=s=>{const i=t.findIndex(h=>h.id===s);if(i>=t.length-1)return;const r=[...t];[r[i],r[i+1]]=[r[i+1],r[i]],D(r)},$=s=>{const{active:i,over:r}=s;if(!r||i.id===r.id)return;const h=t.findIndex(I=>I.id===i.id),o=t.findIndex(I=>I.id===r.id);if(h!==-1&&o!==-1){const I=ce(t,h,o);D(I)}},q=s=>{f(s)},U=s=>{C(s)},R=s=>{l(s.id),d(s.title)},G=()=>{a&&c.trim()&&(j(a,c.trim()),l(null),d(""))},J=()=>{l(null),d("")},W=(s,i)=>{E(s,i)},X=()=>{const s={id:`custom-${Date.now()}`,title:"新模块",iconName:"star",type:"timeline",editorType:"timeline",visible:!0,order:t.length+2,data:[]};v(s),R(s)},Y={sensors:u,onDragEnd:$,sortableItems:t.map(s=>s.id),strategy:L};return{managedSections:t,editingId:a,editingTitle:c,showIconSelector:b,setEditingTitle:d,setShowIconSelector:x,deleteSection:U,addCustomSection:X,startEditing:R,saveEditing:G,cancelEditing:J,updateSectionIcon:W,getEditorType:m,updateEditorType:A,toggleVisibility:q,moveUp:T,moveDown:_,dragConfig:Y,handleDragEnd:$}},Ae=()=>{const[a]=k(F),l=B(Q),[,c]=k(ee),[,d]=k(te),[,b]=k(se),[x,u]=p.useState({});p.useEffect(()=>{const n={};l.forEach(t=>{n[t.id]=t.pageNumber||1}),u(n)},[l]);const y=a.pageSettings?.totalPages||1,g=y>1,S=p.useCallback(()=>{d()},[d]),j=p.useCallback(n=>{b(n)},[b]),E=p.useCallback((n,t)=>{u(m=>({...m,[n]:t}))},[]),w=p.useCallback(()=>{const n={},t=Math.ceil(l.length/2);l.forEach((m,P)=>{n[m.id]=P<t?1:2}),u(n)},[l]),f=p.useCallback(()=>{const n={};l.forEach(t=>{n[t.id]=1}),u(n)},[l]),C=p.useCallback(n=>Object.values(x).filter(t=>t===n).length,[x]),v=p.useCallback(()=>{const n=Object.entries(x).map(([t,m])=>({sectionId:t,pageNumber:m}));c(n)},[x,c]);return p.useEffect(()=>{if(!g)return;const n=setTimeout(()=>{v()},500);return()=>clearTimeout(n)},[x,g,v]),{totalPages:y,isMultiPageEnabled:g,sections:l,localPageAssignments:x,handleAddPage:S,handleRemovePage:j,handleSectionPageChange:E,handleAutoAssign:w,handleResetAssignments:f,getPageSectionCount:C,applyPageAssignments:v}},O=[{value:"timeline",label:"时间线编辑器",description:"适合工作经历、教育背景等时序信息",icon:je},{value:"list",label:"列表编辑器",description:"适合技能清单、证书列表等",icon:fe},{value:"text",label:"文本编辑器",description:"适合自我介绍、备注等自由文本",icon:ve}],Te=({section:a,isEditing:l,editingTitle:c,onStartEditing:d,onSaveEditing:b,onCancelEditing:x,onTitleChange:u,onIconChange:y,onEditorTypeChange:g,onDelete:S,getEditorType:j})=>{const{attributes:E,listeners:w,setNodeRef:f,transform:C,transition:v,isDragging:n}=me({id:a.id,disabled:l}),t={transform:xe.Transform.toString(C),transition:v,opacity:n?.5:1},m=j(a),P=O.find(D=>D.value===m),A=D=>{g(D)};return e.jsx("div",{ref:f,style:t,className:`group border border-gray-200 rounded-lg bg-white shadow-sm hover:shadow-md transition-all duration-200 ${n?"shadow-lg scale-105":""}`,children:e.jsxs("div",{className:"flex items-center gap-3 p-4",children:[e.jsx("div",{...E,...w,className:`flex-shrink-0 p-1 rounded hover:bg-gray-100 transition-colors cursor-grab active:cursor-grabbing ${l?"cursor-not-allowed opacity-50":""}`,children:e.jsx(be,{className:"h-4 w-4 text-gray-400"})}),e.jsx("div",{className:"flex-1 min-w-0",children:l?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(z,{htmlFor:`title-${a.id}`,className:"text-xs text-gray-500",children:"模块标题"}),e.jsx(ae,{id:`title-${a.id}`,value:c,onChange:D=>u(D.target.value),placeholder:"请输入模块标题",className:"h-8 text-sm"})]}),e.jsx("div",{className:"space-y-1",children:e.jsx(ne,{value:a.iconName,onChange:y,label:"图标"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(z,{htmlFor:`editor-${a.id}`,className:"text-xs text-gray-500",children:"编辑器类型"}),e.jsx(pe,{value:m,onValueChange:A,placeholder:"选择编辑器类型",options:O})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-1",children:[e.jsxs(N,{onClick:b,size:"sm",className:"h-7 px-2 text-xs bg-blue-600 hover:bg-blue-700",children:[e.jsx(ye,{className:"h-3 w-3 mr-1"}),"保存"]}),e.jsxs(N,{onClick:x,variant:"outline",size:"sm",className:"h-7 px-2 text-xs",children:[e.jsx(Ne,{className:"h-3 w-3 mr-1"}),"取消"]})]})]}):e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 text-sm truncate",children:a.title}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[P?.label," • ",a.visible?"显示中":"已隐藏"]})]})}),!l&&e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(N,{onClick:d,variant:"ghost",size:"icon",className:"h-7 w-7 hover:bg-gray-100",children:e.jsx(Se,{className:"h-3 w-3 text-gray-600"})}),e.jsx(N,{onClick:S,variant:"ghost",size:"icon",className:"h-7 w-7 hover:bg-red-50 hover:text-red-600",children:e.jsx(V,{className:"h-3 w-3"})})]})]})})},$e=({pageNumber:a,sections:l,editingId:c,editingTitle:d,onStartEditing:b,onSaveEditing:x,onCancelEditing:u,onTitleChange:y,onIconChange:g,onEditorTypeChange:S,onDelete:j,getEditorType:E,onAddSection:w,onRemovePage:f})=>{const{isOver:C,setNodeRef:v}=ge({id:`page-${a}`,data:{pageNumber:a}}),n=l.filter(t=>(t.pageNumber||1)===a);return e.jsxs("div",{ref:v,className:`relative border rounded-lg p-4 transition-all duration-200 ${C?"border-blue-500 bg-blue-50":a===1?"border-gray-300 bg-white":"border-gray-200 bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4 text-gray-600"}),e.jsxs("h3",{className:"font-medium text-gray-900",children:[a===1?"第1页":`第${a}页`,a===1&&" (基本信息)"]}),e.jsxs("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:[n.length," 个模块"]})]}),a>1&&f&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(N,{onClick:()=>f(a),size:"sm",variant:"outline",className:"text-xs text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),"删除页面"]})})]}),e.jsx(he,{items:n.map(t=>t.id),strategy:L,children:e.jsxs("div",{className:"space-y-2 min-h-[100px]",children:[n.map(t=>e.jsx(Te,{section:t,isEditing:c===t.id,editingTitle:d,onStartEditing:()=>b(t),onSaveEditing:x,onCancelEditing:u,onTitleChange:y,onIconChange:m=>g(t.id,m),onEditorTypeChange:m=>S(t.id,m),onDelete:()=>j(t.id),getEditorType:E},t.id)),n.length===0&&a>1&&e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(M,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"拖拽模块到此页"})]}),a===1&&e.jsx("div",{className:"pt-2 border-t border-dashed border-gray-300",children:e.jsxs(N,{onClick:w,size:"sm",variant:"outline",className:"w-full text-gray-600 border-dashed",children:[e.jsx(Z,{className:"h-4 w-4 mr-1"}),"添加新模块"]})})]})}),C&&e.jsx("div",{className:"absolute inset-0 border-2 border-blue-500 border-dashed rounded-lg bg-blue-50 bg-opacity-50 flex items-center justify-center z-10",children:e.jsxs("div",{className:"bg-blue-500 text-white px-3 py-1 rounded text-sm font-medium",children:["放置到第",a,"页"]})})]})},Re=()=>{const{managedSections:a,editingId:l,editingTitle:c,setEditingTitle:d,deleteSection:b,addCustomSection:x,startEditing:u,saveEditing:y,cancelEditing:g,updateSectionIcon:S,getEditorType:j,updateEditorType:E,dragConfig:w}=ke(),f=Ae(),C=v=>{const{active:n,over:t}=v;if(t){if(t.id.toString().startsWith("page-")){const m=parseInt(t.id.toString().replace("page-","")),P=n.id.toString();f.handleSectionPageChange(P,m);return}w.onDragEnd(v)}};return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"px-4 md:px-6 lg:px-8 py-3 md:py-4 border-b border-gray-200",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h2",{className:"font-semibold text-gray-900 text-base md:text-lg",children:"模块管理"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1 hidden md:block",children:"拖拽模块到不同页面容器中进行分页管理"})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 md:px-6 lg:px-8",children:e.jsx("div",{className:"py-4 md:py-6",children:e.jsx(ue,{sensors:w.sensors,onDragEnd:C,children:e.jsxs("div",{className:"space-y-4",children:[Array.from({length:f.totalPages},(v,n)=>{const t=n+1;return e.jsx($e,{pageNumber:t,sections:a,editingId:l,editingTitle:c,onStartEditing:u,onSaveEditing:y,onCancelEditing:g,onTitleChange:d,onIconChange:S,onEditorTypeChange:E,onDelete:b,getEditorType:j,onAddSection:x,onRemovePage:f.handleRemovePage},t)}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsxs(N,{onClick:f.handleAddPage,variant:"outline",className:"text-gray-600 hover:text-gray-800",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"添加新页面"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"添加更多页面来组织您的简历内容"})]})]})})})})]})},ze=()=>{const a=B(F),l=()=>100,[c,d]=p.useState(l()),b=()=>{d(j=>Math.min(j+10,150))},x=()=>{d(j=>Math.max(j-10,50))},u=()=>{d(l())},y=()=>{const g=`${window.location.origin}${window.location.pathname}#/preview`;window.open(g,"_blank","noopener,noreferrer")};return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"px-4 md:px-6 py-3 md:py-4 border-b border-gray-200 bg-white flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h2",{className:"font-semibold text-gray-900 text-base md:text-lg",children:"实时预览"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1 hidden md:block",children:"左侧的修改会立即在此处显示"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-1 px-2 md:px-3 py-1 bg-gray-100 rounded-lg",children:[e.jsx(N,{onClick:x,variant:"ghost",size:"icon",className:"h-6 w-6 md:h-6 md:w-6",disabled:c<=50,children:e.jsx(we,{className:"h-3 w-3"})}),e.jsxs("span",{className:"font-medium text-gray-600 text-center text-xs min-w-[2.5rem] md:min-w-[3rem]",children:[c,"%"]}),e.jsx(N,{onClick:b,variant:"ghost",size:"icon",className:"h-6 w-6 md:h-6 md:w-6",disabled:c>=150,children:e.jsx(Ce,{className:"h-3 w-3"})}),e.jsx(N,{onClick:u,variant:"ghost",size:"icon",className:"h-6 w-6 md:h-6 md:w-6 ml-1",title:"重置缩放",children:e.jsx(Ee,{className:"h-3 w-3"})})]}),e.jsxs(N,{onClick:y,variant:"outline",size:"sm",className:"flex items-center space-x-2",children:[e.jsx(De,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"预览 & 导出"})]})]})]})}),e.jsx("div",{className:"flex-1 overflow-auto bg-gradient-to-br from-gray-50 to-gray-100 p-3 md:p-6",children:e.jsx("div",{className:"flex justify-start md:justify-center min-h-full md:min-h-0",children:e.jsx("div",{className:"w-full overflow-hidden",children:e.jsx(ie,{resume:a,isEditable:!1,scale:c,className:"min-h-0 vertical-layout-preview"})})})})]})},Me=()=>{const a=Ie(),l=()=>{a("/")};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-blue-50 to-purple-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(N,{onClick:l,variant:"outline",size:"sm",className:"flex items-center space-x-2",children:[e.jsx(Pe,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"返回"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("div",{children:e.jsx("h1",{className:"text-lg font-semibold text-gray-900 flex items-center gap-3",children:"模块管理"})})})]})})}),e.jsxs("div",{className:"flex flex-col lg:flex-row",children:[e.jsx("div",{className:"w-full lg:w-1/2 border-b lg:border-b-0 lg:border-r border-gray-200 bg-white h-1/2 lg:h-full overflow-hidden",children:e.jsx(Re,{})}),e.jsx("div",{className:"w-full lg:w-1/2 bg-gray-50 h-1/2 lg:h-full overflow-hidden",children:e.jsx(ze,{})})]}),e.jsx(re,{})]})},Ge=()=>e.jsx(Me,{});export{Ge as SectionManagerPage};
